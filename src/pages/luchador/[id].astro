---
import Layout from '@/layouts/Layout.astro'
import BoxerWorkout from '@/components/BoxerWorkout.astro'
import BoxerSocialLink from '@/components/BoxerSocialLink.astro'

import { FIGHTERS } from '@/consts/fighters'
import { fixedTitle } from '@/consts/pageTitles'
import { COMBATS } from '@/consts/combats'
import { countries } from '@/consts/countries'
import CombatVersus from '@/components/CombatVersus.astro'

const { id } = Astro.params
if (!id) return Astro.redirect('/404')

const fighter = FIGHTERS.find((fighter) => fighter.id === id)
if (!fighter) return Astro.redirect('/404')

const combat = COMBATS.find((combat) => combat.fighters.includes(id))
const combatId = combat?.id
console.log({ combatId })

const description = `Biografía, estadísticas y clips de ${fighter.name}, participante de La Velada del Año V. ${fighter.bio.substring(0, 120)}${fighter.bio.length > 120 ? '...' : ''}`
const canonical = `https://www.infolavelada.com/luchador/${id}`

const birthDate = fighter.birthDate.toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
})

const details = [
  { label: 'Edad', value: `${fighter.age} AÑOS` },
  { label: 'Altura', value: `${fighter.height}M` },
  { label: 'Peso', value: `${fighter.weight}KG` },
  { label: 'Nacimiento', value: birthDate },
]

const country = countries.find((c) => c.id === fighter?.country)

export const prerender = true

export const getStaticPaths = () => {
  return FIGHTERS.map((fighter) => ({
    params: { id: fighter.id },
  }))
}
---

<Layout title={`${fighter.name} | ${fixedTitle}`} description={description} canonical={canonical}>
  <section class="relative mt-5 flex w-full flex-col-reverse lg:min-h-screen lg:flex-row">
    <!-- Boxeador perfil -->
    <div
      id="fighter-container"
      class="relative mx-auto my-12 flex w-full max-w-2xl flex-col items-center justify-center gap-8 p-6 lg:max-w-6xl lg:flex-row lg:items-start"
    >
      <!-- Imagen del Boxeador -->
      <div class="relative w-full max-w-sm flex-shrink-0">
        <img
          src={`/images/fighters/big/${id}.webp`}
          alt={`Retrato de ${fighter.name}, participante de La Velada V`}
          class="mask-fade-bottom h-auto w-full object-contain transition-transform duration-700 hover:scale-105"
          transition:name={`image-${id}`}
        />
      </div>

      <!-- Datos del Boxeador -->
      <div class="text-theme-seashell flex w-full flex-col items-start justify-start gap-6">
        <!-- Nombre del Boxeador -->
        <div class="flex flex-col items-start gap-2">
          <span class="text-xl font-bold uppercase sm:text-2xl">{fighter.realName}</span>
          <img
            src={`/images/fighters/text/${id}.webp`}
            alt={`Nombre de ${fighter.name} en texto decorativo`}
            class="h-10 w-auto sm:h-12"
            transition:name={`text-${id}`}
          />
        </div>

        <!-- Biografía -->
        {
          fighter?.bio && (
            <p class="text-base lowercase leading-relaxed sm:text-lg md:text-xl">{fighter.bio}</p>
          )
        }

        <!-- Estadísticas -->
        <div class="flex flex-col items-start gap-4">
          <span class="text-xl font-bold uppercase sm:text-2xl">estadísticas</span>
          <div class="flex flex-wrap gap-6">
            {
              details.map((detail) => (
                <div class="flex flex-col gap-1.5 text-sm sm:text-base md:text-lg">
                  <span class="font-bold uppercase">{detail.label}</span>
                  <p class="lowercase">{detail.value}</p>
                </div>
              ))
            }
          </div>
        </div>

        <!-- Nacionalidad -->
        {
          country?.id && (
            <div class="flex items-center gap-4">
              <img
                src={country?.image.src}
                alt={`Bandera de ${country?.name ?? 'Desconocido'}`}
                class="h-auto w-14 sm:w-20 md:w-24"
              />
              <span class="text-xl font-bold uppercase sm:text-2xl">{fighter?.city}</span>
            </div>
          )
        }

        <!-- Redes -->
        <div class="flex flex-wrap items-center justify-start gap-2 px-1 sm:px-4 lg:px-0">
          {(fighter.socials || [])?.map((item) => <BoxerSocialLink social={item} />)}
        </div>
      </div>
    </div>
  </section>

  {
    combat && (
      <section class="mx-auto max-w-6xl px-4">
        <CombatVersus id={combatId} />
      </section>
    )
  }

  <!-- Video de Entrenamientos -->
  <section>
    {fighter.workout && <BoxerWorkout workout={fighter.workout} />}
  </section>
  <!-- Fin de video de entrenamientos -->
</Layout>

<style>
  .stat-item {
    animation: fadeIn 0.5s ease-out forwards;
    opacity: 0;
  }

  .stat-item:nth-child(1) {
    animation-delay: 0.1s;
  }
  .stat-item:nth-child(2) {
    animation-delay: 0.2s;
  }
  .stat-item:nth-child(3) {
    animation-delay: 0.3s;
  }
  .stat-item:nth-child(4) {
    animation-delay: 0.4s;
  }

  .mask-image-fade-bottom {
    mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
  }

  #fighter-container {
    grid-template-columns: 1fr;
  }

  @media (min-width: 768px) {
    #fighter-container {
      grid-template-columns: repeat(2, 1fr);
    }

    #fighter-container > a:first-child {
      grid-column: 1 / -1;
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
