---
import { FIGHTERS } from '@/consts/fighters'
import Layout from '@/layouts/Layout.astro'
import { fixedTitle } from '@/consts/pageTitles'
import BoxerWorkout from '@/components/BoxerWorkout.astro'
import BoxerCard from '@/components/BoxerCard.astro'
import BoxerClip from '@/components/BoxerClip.astro'
import LiteYouTube from '@/components/LiteYouTube.astro'
import { COMBATS } from '@/consts/combats'

const { id } = Astro.params

const fighter = FIGHTERS.find((fighter) => fighter.id === id)
if (!fighter) return Astro.redirect('/404')

const birthDate = fighter.birthDate.toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
})

const { faceOff } = COMBATS.find(combat => combat.fighters.includes(fighter.id))!;
const opponent = FIGHTERS.find((f) => f.id === fighter.versus)
---

<Layout title={`${fighter.name} | ${fixedTitle}`}>
  <section class="w-full xl:min-h-screen pt-24 lg:pt-32 pb-10 xl:pb-0 relative overflow-x-hidden lowercase rounded-none md:bg-gradient-to-r from-black/70 via-black/0 to-black/70">
    <div class="mask-fade-bottom w-full absolute inset-0 bg-[url('/images/hero.avif')] bg-cover bg-center" />
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-12 gap-4">

        <!-- T√≠tulo, nombre, video y descripci√≥n -->
        <div class="col-span-12 md:col-span-7 xl:col-span-4 xl:row-span-3 flex flex-col space-y-5">
          <div class="animate-fade-in-up text-center md:text-left">
            <h1 class="text-5xl font-bold text-white mb-4">
              {fighter.name}
            </h1>
            <h2 class="text-2xl text-gray-300">
              {fighter.realName}
            </h2>
          </div>
          
          {fighter.workout && (
            <div class="animate-fade-in-right animate-delay-100 rounded-xl overflow-hidden shadow-lg">
              <LiteYouTube videoId={fighter.workout.videoID} backgroundImage={fighter.workout.thumbnail} />
            </div>
          )}
          
          <div class="animate-fade-in-up animate-delay-100 text-white text-center md:text-left bg-theme-raisin-black/50 hover:bg-theme-raisin-black/80 backdrop-blur-sm p-4 transition duration-300 cursor-default">
            <h3 class="text-xl font-semibold mb-3">Sobre {fighter.name}</h3>
            <p>
              Boxeador espa√±ol conocido por su estilo agresivo y determinaci√≥n. Con una t√©cnica refinada y gran velocidad, se ha convertido en uno de los favoritos de La Velada del A√±o.
            </p>
          </div>

          <!-- <BoxerClip clips={fighter.clips} /> üö© Midu te quiero, pongamos esto en otra ubicaci√≥n -->
        </div>
        
        <!-- Foto de luchador -->
        <div class="col-span-8 md:col-span-5 xl:col-span-4 row-span-2 xl:row-span-3 relative flex justify-center items-end sm:translate-x-20 md:translate-x-0">
          <img
            src={`/images/fighters/big/${id}.webp`}
            alt={fighter.name}
            class="mask-image-fade-bottom animate-fade-in w-full h-[32rem] xl:h-[80dvh] md:min-h-[40rem] object-contain transition-all duration-700 hover:scale-105"
            transition:name={`image-${id}`}
          />
          <img
            src={`/images/fighters/text/${id}.png`}
            alt={fighter.name}
            class="animate-slide-in-top w-auto h-20 absolute bottom-0 md:bottom-24 object-contain"
            transition:name={`text-${id}`}
          />
        </div>
        
        <!-- Datos de luchador -->
        <div class="order-last xl:order-none col-span-12 xl:col-span-4 flex flex-col space-y-6 text-white bg-theme-raisin-black/50 hover:bg-theme-raisin-black/80 backdrop-blur-sm p-4 transition duration-300 cursor-default">
          <h3 class="text-xl font-semibold mb-4 text-center">Datos del luchador</h3>
          
          <div class="grid grid-cols-2 gap-4 text-center mb-6">
            <div class="stat-item">
              <div class="text-sm text-gray-400">Edad</div>
              <div class="text-lg">{fighter.age} a√±os</div>
            </div>
            <div class="stat-item">
              <div class="text-sm text-gray-400">Altura</div>
              <div class="text-lg">{fighter.height}m</div>
            </div>
            <div class="stat-item">
              <div class="text-sm text-gray-400">Peso</div>
              <div class="text-lg">{fighter.weight}kg</div>
            </div>
            <div class="stat-item">
              <div class="text-sm text-gray-400">Ciudad</div>
              <div class="text-lg">{fighter.city}</div>
            </div>
          </div>
          
          <div class="animate-fade-in-up animate-delay-200 text-center">
            <div class="text-sm text-gray-400">Fecha de nacimiento</div>
            <div class="text-lg">{birthDate}</div>
          </div>
        </div>

        <!-- Oponente -->
        <div class="xl:animate-fade-in-left animate-delay-100 col-span-4 md:col-span-7 xl:col-span-4 row-span-2 md:row-span-1 relative pt-20 md:pt-0 xl:pt-20 flex flex-1 items-center justify-end md:justify-center xl:justify-start gap-4 text-white text-center">
          <img src="/images/versus.png" alt="Versus" class="w-auto h-10 md:order-last xl:order-first object-contain" />
          <BoxerCard 
            id={opponent!.id} 
            name={opponent!.name}
            versus={fighter.versus}
            class="min-w-20 group-hover:scale-110"
          />
        </div>
      </div>
    </div>
    
    <!-- Redes sociales de luchador -->
    <div class="relative xl:bg-gradient-to-t from-[#f19fca] from-30% to-theme-tickle-me-pink/0 py-5 flex flex-wrap justify-center gap-3 text-white lowercase">
      {
        (fighter.socials || [])?.map(({ url, image, name, label, followers }) => (
          <a
            href={url}
            target="_blank"
            aria-label={label ?? name}
            class="w-20 bg-gradient-to-b hover:to-theme-turquoise/70 hover:from-theme-tickle-me-pink/70 from-theme-raisin-black/50 to-theme-raisin-black/0 backdrop-blur-sm flex xl:-translate-y-16 py-3 px-2 flex-col items-center justify-center transition duration-500 hover:scale-125"
          >
            <image.logo />
            <span>{followers}</span>
          </a>
        ))
      }
    </div>
  </section>

  <!-- Video de cara a cara -->
  <section class="max-w-6xl mx-auto my-36 px-2 lg:px-10">
    <div class="text-dark-magenta text-center">
      <h3 class="text-4xl font-light uppercase mb-5">Cara a cara</h3>
      <p class="text-2xl lowercase">Revive el momento del cara a cara antes del gran combate. ¬øQui√©n dominar√° el ring?</p>
    </div>
    <div class="mt-10 pt-12">
      <LiteYouTube videoId={faceOff.videoID} backgroundImage={faceOff.thumbnail} />
    </div>
  </section>
</Layout>

<style>
  .stat-item {
    animation: fadeIn 0.5s ease-out forwards;
    opacity: 0;
  }

  .stat-item:nth-child(1) {
    animation-delay: 0.1s;
  }
  .stat-item:nth-child(2) {
    animation-delay: 0.2s;
  }
  .stat-item:nth-child(3) {
    animation-delay: 0.3s;
  }
  .stat-item:nth-child(4) {
    animation-delay: 0.4s;
  }

  .mask-image-fade-bottom {
    mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
